<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--<link rel="stylesheet" href="css/normalize.css">-->
    <link href="https://fonts.googleapis.com/css?family=Oswald" rel="stylesheet">
    <!-- Your web-app is https, so your scripts need to be too -->
    <script src="https://code.jquery.com/jquery-2.2.1.min.js" integrity="sha256-gvQgAFzTH6trSrAWoH1iPo9Xc96QxSZ3feW6kem+O00=" crossorigin="anonymous"></script>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Latest compiled and minified JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.js"></script>
  <![endif]-->
    <link rel="stylesheet" type="text/css" href="css/styles.css">
    <script src="js/scripts.js"></script>
</head>

<body>
    <nav class="navbar navbar-default" role="navigation">
        <!-- Brand and toggle get grouped for better mobile display -->
        <a class="navbar-brand" rel="home" id="roomid">AAAA</a>
        <div class="navbar-header"> &nbsp;
            <button class="btn btn-default navbar-btn dropdown-toggle " type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"> <span class="glyphicon glyphicon-menu-hamburger" aria-hidden="true"></span> </button>
            <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                <li><a href="#"><i class="glyphicon glyphicon-question-sign"></i>  Home</a></li>
                <li> <a href="#"><i class="glyphicon glyphicon-question-sign"></i> Cafeterias</a></li>
                <li> <a href="#"><i class="glyphicon glyphicon-question-sign"></i> Rooms</a></li>
                <li> <a href="#"><i class="glyphicon glyphicon-question-sign"></i> How to use</a></li>
                <li> <a href="#"><i class="glyphicon glyphicon-question-sign"></i> Others</a></li>
                <li> <a href="#"><i class="glyphicon glyphicon-question-sign"></i> Contact</a></li>
            </ul>
        </div>
        <!-- Collect the nav links, forms, and other content for toggling -->
        <div class="collapse navbar-collapse" id="navbar-collapse-1">
            <form class="navbar-form navbar-left" role="search" id="nav-search">
                <div class="form-group">
                    <input type="text" class="form-control" placeholder="Search"> </div>
                <button type="submit" class="btn btn-default"><i class="glyphicon glyphicon-search"></i></button>
            </form>
            <ul class="nav navbar-nav navbar-right" id="side-options">
                <li><a href="#">About</a></li>
                <li><a href="#">Contact</a></li>
            </ul>
        </div>
        <!-- /.navbar-collapse -->
    </nav>
    <!--
HEADER ENDS & MAP STARTS
-->

<nav class="fixed floor-pagination" aria-label="Page navigation">
  <ul class="pagination">
    <li class="f1"><a href="#">1</a></li>
    <li class="f2"><a href="#">2</a></li>
  </ul>
</nav>
    <div id="map-wrapper">
			<img id="mark" src="img/mark.PNG"/>
    </div>

    <script type="text/javascript">
    $(document).ready(function() {
      var roomId = GetURLParameter('roomId')
      var organizationName = GetURLParameter('organization')
    	$.ajax({
    		url: '/api/rooms?roomName=' + roomId + '&organization=' + organizationName,
    		type: 'get',
    		contentType: 'application/json; charset=UTF-8',
    		success: function(data) {
    			renderMap(data)
    		},
    		error: function(error, textStatus, errorThrown) {
    			console.log(error)
    		}
    	})


      function renderMap(response) {
        var floorImage = document.createElement('img')
        if (response.hasOwnProperty('floor')) {
          floorImage.src = response.floor.baseImage
        }
        var mapWrapper = document.getElementById('map-wrapper')
        mapWrapper.appendChild(floorImage)

        $(floorImage)
          .attr("src", $(floorImage).attr("src"))
            .load(function() {
              mapWrapper.style.width = this.width + 'px';
              mapWrapper.style.height = this.height + 'px';

              if (response.coordinates.constructor === Array && response.coordinates.length > 0) {
                initMarker(response.coordinates[0].longitude, response.coordinates[0].latitude)
        			}
          });

        console.log(floorImage.width)
        console.log(floorImage.height)

      }

    	function doTricksWithData(response) {
    		console.log('Response looks like this', response)
    		//Logging property 'name' of response object
    		console.log('Room name', response.name)
    		//Making sure that response has property 'organization'
    		//Otherwise it would lead to errors if trying to read
    		// property of undefined
    		if (response.hasOwnProperty('organization')) {
    			console.log("Organization name", response.organization.name)
    		}
    		if (response.hasOwnProperty('coordinates')) {
    			//Coordinates come in as an array, but index [0] is always valid
    			//Making sure that coordinates is type of Array and that it has data in it
    			if (response.coordinates.constructor === Array && response.coordinates.length > 0) {
    				console.log('Latitude', response.coordinates[0].latitude)
    				console.log('Longitude', response.coordinates[0].longitude)
    			}
    		}
    		if (response.hasOwnProperty('floor')) {
    			console.log('Floor name', response.floor.name)
    			console.log('Reference to floor base image:', response.floor.baseImage)
    			//Going even deeper
    			if (response.floor.hasOwnProperty('building')) {
    				console.log('Building name', response.floor.building.name)
    			}
    		}
    		console.log('Reference to room photo (maybe unnecessary)', response.photo)
    	}
    })
    </script>
</body>

</html>